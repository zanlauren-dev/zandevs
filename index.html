<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="auth.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <title>Login | DNHS PORTAL</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
    
    :root {
      --primary: #6366f1;
      --secondary: #8b5cf6;
      --accent: #06b6d4;
      --dark: #0b1120;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body { 
      font-family: 'Plus Jakarta Sans', sans-serif; 
      background: var(--dark);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow-x: hidden;
    }

    .bg-gradient-animate {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1;
      background: url('MAIN BG.jpg') no-repeat center center fixed;
      background-size: cover;
    }

    .bg-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1;
      background: rgba(11, 17, 32, 0.85);
    }

    .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
    .particle { position: absolute; width: 4px; height: 4px; background: rgba(99, 102, 241, 0.3); border-radius: 50%; animation: float 15s infinite; }

    @keyframes float {
      0%, 100% { transform: translateY(100vh); opacity: 0; }
      10%, 90% { opacity: 1; }
      100% { transform: translateY(-10vh); }
    }

    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    .rgb-container { 
      position: relative; 
      border-radius: 1.5rem;
      background: rgba(11, 17, 32, 0.85);
      backdrop-filter: blur(20px);
      z-index: 1; 
      width: 92%;
      max-width: 500px;
      animation: fadeInUp 0.8s ease-out;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 80px rgba(0, 0, 0, 0.5);
      padding: 2rem;
    }

    .logo-rgb-frame {
      width: 100px; height: 100px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto;
      animation: floating 6s ease-in-out infinite;
    }

    @keyframes floating { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    .input-glow:focus {
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
    }

    .auth-btn {
      width: 100%; padding: 0.75rem; border-radius: 0.75rem;
      font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.5rem;
      transition: all 0.3s ease;
    }

    @keyframes skySpin { 
      0% { stroke-dashoffset: 95; } 
      100% { stroke-dashoffset: -95; } 
    }
  </style>
</head>
<body class="antialiased text-slate-200">

<div class="bg-gradient-animate"></div>
<div class="bg-overlay"></div>
<div class="particles" id="particles"></div>

<div class="rgb-container">
  <div class="text-center">
    <div class="logo-rgb-frame">
      <div class="w-[90%] h-[90%] rounded-full overflow-hidden bg-slate-900">
        <img src="LOGO.png" alt="Logo" class="w-full h-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=DNHS&background=0b1120&color=fff'" />
      </div>
    </div>

    <h2 class="mt-6 text-3xl font-extrabold text-white uppercase tracking-tight">
      DNHS <span class="bg-gradient-to-r from-indigo-500 to-cyan-500 bg-clip-text text-transparent">PORTAL</span>
    </h2>
    <p class="text-[10px] font-semibold text-slate-500 uppercase tracking-[0.4em] mt-2 mb-8">Official Student Management System</p>

    <form id="loginForm" class="space-y-4 text-left">
      <div>
        <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-widest ml-1">Authorized Email</label>
        <div class="relative mt-1">
          <input type="email" id="email" placeholder="Email" required
                 class="input-glow w-full bg-white/[0.03] border border-white/10 p-3 pl-11 rounded-lg text-white outline-none transition-all">
          <i class="fas fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
        </div>
      </div>
      
      <div>
        <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-widest ml-1">Access Password</label>
        <div class="relative mt-1">
          <input type="password" id="password" placeholder="••••••••" required
                 class="input-glow w-full bg-white/[0.03] border border-white/10 p-3 pl-11 rounded-lg text-white outline-none transition-all">
          <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
          <button type="button" onclick="togglePassword()" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 hover:text-indigo-400">
            <i id="toggleIcon" class="fas fa-eye"></i>
          </button>
        </div>
      </div>
      
      <button type="submit" class="auth-btn bg-indigo-600 hover:bg-indigo-500 text-white shadow-lg shadow-indigo-500/20 mt-2">
        Sign In
      </button>
    </form>

    <div class="mt-8 flex flex-col sm:flex-row justify-center gap-3">
      <a href="register.html" class="px-6 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-sm font-medium text-slate-300 hover:text-white transition-all duration-300 hover:shadow-lg hover:shadow-indigo-500/20 hover:border-indigo-500/30">
        <i class="fas fa-user-plus mr-2"></i>Create Account
      </a>
      <a href="forgot-pass.html" class="px-6 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-sm font-medium text-slate-300 hover:text-white transition-all duration-300 hover:shadow-lg hover:shadow-indigo-500/20 hover:border-indigo-500/30">
        <i class="fas fa-key mr-2"></i>Forgot Password
      </a>
      <a href="https://www.facebook.com/rixx.carti" target="_blank" class="px-6 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-sm font-medium text-slate-300 hover:text-blue-400 transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/20 hover:border-blue-500/30">
        <i class="fas fa-headset mr-2"></i>Support
      </a>
    </div>
  </div>
</div>

<script>
  // Particle Background
  function createParticles() {
    const container = document.getElementById('particles');
    for (let i = 0; i < 20; i++) {
      const p = document.createElement('div');
      p.className = 'particle';
      p.style.left = Math.random() * 100 + '%';
      p.style.animationDelay = Math.random() * 10 + 's';
      p.style.width = Math.random() * 5 + 'px';
      container.appendChild(p);
    }
  }
  createParticles();

  // AUTH LOGIC
  window.onload = () => {
    // Bantayan ang login status
    if (typeof window.supabaseClient !== 'undefined' && window.supabaseClient) {
      window.supabaseClient.auth.onAuthStateChange((event, session) => {
        if (event === "SIGNED_IN" && session) {
          const email = session.user.email.toLowerCase();
          // Siguraduhin na ang ADMIN_EMAIL ay nasa auth.js
          const isAdmin = email === ADMIN_EMAIL.toLowerCase();

          Swal.fire({
            icon: 'success',
            title: isAdmin ? 'ADMIN ACCESS' : 'STUDENT ACCESS',
            text: 'Welcome to DNHS Portal!',
            background: '#0b1120', color: '#fff', showConfirmButton: false, timer: 1500
          });

          setTimeout(() => {
            window.location.href = isAdmin ? 'admin.html' : 'student-dashboard.html';
          }, 1500);
        }
      });
    }
  };

  document.getElementById('loginForm').onsubmit = async (e) => {
    e.preventDefault();
    if (typeof window.supabaseClient === 'undefined' || !window.supabaseClient) {
      Swal.fire({ icon: 'error', title: 'Error', text: 'System initializing... Please try again.', background: '#0b1120', color: '#fff' });
      return;
    }
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    Swal.fire({ title: 'Verifying...', didOpen: () => Swal.showLoading(), background: '#0b1120', color: '#fff', showConfirmButton: false });

    const { error } = await window.supabaseClient.auth.signInWithPassword({ email, password });
    if (error) {
      Swal.fire({ icon: 'error', title: 'Login Failed', text: error.message, background: '#0b1120', color: '#fff' });
    }
  };

  function togglePassword() {
    const passField = document.getElementById('password');
    const icon = document.getElementById('toggleIcon');
    if (passField.type === 'password') {
      passField.type = 'text';
      icon.className = 'fas fa-eye-slash';
    } else {
      passField.type = 'password';
      icon.className = 'fas fa-eye';
    }
  }
</script>

</body>
</html>
