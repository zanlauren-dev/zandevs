<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<title>Recovery | DNHS PORTAL</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', sans-serif;
    background-image: url('MAIN BG.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    overflow: hidden;
  }

  /* Animated background particles */
  .particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
    z-index: 0;
  }

  .particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(99, 102, 241, 0.3);
    border-radius: 50%;
    animation: float-particle 15s infinite;
  }

  @keyframes float-particle {
    0%, 100% {
      transform: translateY(100vh) translateX(0) scale(0);
      opacity: 0;
    }
    10% {
      opacity: 1;
      transform: translateY(80vh) translateX(10px) scale(1);
    }
    90% {
      opacity: 1;
    }
    100% {
      transform: translateY(-10vh) translateX(-10px) scale(0.5);
      opacity: 0;
    }
  }

  /* Glass Card with entrance animation */
  .glass-card {
    position: relative;
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
    box-shadow: 
      0 8px 32px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
    opacity: 0;
    transform: translateY(30px) scale(0.95);
    animation: card-enter 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    z-index: 10;
  }

  @keyframes card-enter {
    0% {
      opacity: 0;
      transform: translateY(30px) scale(0.95);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* Icon with glow */
  .icon-container {
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: 50%;
    padding: 16px;
    margin-bottom: 20px;
    opacity: 0;
    animation: icon-enter 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.3s forwards;
  }

  @keyframes icon-enter {
    0% {
      opacity: 0;
      transform: scale(0.5);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  .icon-container i {
    font-size: 32px;
    color: #6366f1;
    text-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
  }

  /* Form elements staggered entrance */
  .form-section {
    opacity: 0;
    transform: translateY(20px);
  }

  .form-section:nth-child(1) { animation: form-enter 0.5s cubic-bezier(0.16, 1, 0.3, 1) 0.5s forwards; }
  .form-section:nth-child(2) { animation: form-enter 0.5s cubic-bezier(0.16, 1, 0.3, 1) 0.6s forwards; }
  .form-section:nth-child(3) { animation: form-enter 0.5s cubic-bezier(0.16, 1, 0.3, 1) 0.7s forwards; }

  @keyframes form-enter {
    0% {
      opacity: 0;
      transform: translateY(20px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Glass Input */
  .glass-input-group {
    position: relative;
  }

  .glass-input {
    width: 100%;
    padding: 16px 16px 16px 48px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    color: white;
    font-size: 15px;
    font-weight: 500;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .glass-input::placeholder {
    color: rgba(255, 255, 255, 0.3);
    transition: all 0.3s ease;
  }

  .glass-input:focus {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(99, 102, 241, 0.5);
    box-shadow: 
      0 0 0 4px rgba(99, 102, 241, 0.1),
      0 8px 24px rgba(99, 102, 241, 0.15);
    outline: none;
    transform: translateY(-2px);
  }

  .glass-input:focus::placeholder {
    opacity: 0.5;
    transform: translateX(5px);
  }

  .input-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(255, 255, 255, 0.3);
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .glass-input:focus + .input-icon {
    color: #6366f1;
    transform: translateY(-50%) scale(1.1);
  }

  /* Button with gradient and hover effects */
  .btn-primary {
    position: relative;
    width: 100%;
    padding: 16px 24px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
    background-size: 200% 200%;
    border: none;
    border-radius: 16px;
    color: white;
    font-size: 15px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
  }

  .btn-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s ease;
  }

  .btn-primary:hover::before {
    left: 100%;
  }

  .btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 
      0 10px 30px rgba(99, 102, 241, 0.4),
      0 0 20px rgba(139, 92, 246, 0.3);
    background-position: 100% 0;
  }

  .btn-primary:active {
    transform: translateY(-1px) scale(0.98);
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
  }

  .btn-primary.loading {
    pointer-events: none;
    opacity: 0.8;
  }

  /* Back link with hover effect */
  .back-link {
    position: relative;
    color: rgba(255, 255, 255, 0.5);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .back-link::before {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 1px;
    background: linear-gradient(90deg, #6366f1, #8b5cf6);
    transition: width 0.3s ease;
  }

  .back-link:hover {
    color: #6366f1;
  }

  .back-link:hover::before {
    width: 100%;
  }

  /* Title animations */
  .title-enter {
    opacity: 0;
    transform: translateY(10px);
    animation: title-enter 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.4s forwards;
  }

  @keyframes title-enter {
    0% {
      opacity: 0;
      transform: translateY(10px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .subtitle-enter {
    opacity: 0;
    animation: subtitle-enter 0.5s cubic-bezier(0.16, 1, 0.3, 1) 0.55s forwards;
  }

  @keyframes subtitle-enter {
    0% {
      opacity: 0;
      transform: translateY(5px);
    }
    100% {
      opacity: 0.5;
      transform: translateY(0);
    }
  }

  /* Simple Fade Transition */
  .fade-transition {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #0f172a;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .fade-transition.active {
    opacity: 1;
    pointer-events: all;
  }

  /* Fade out animation for content */
  .fade-out {
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.25s ease, transform 0.25s ease;
  }

  /* Responsive Design */
  @media (max-width: 480px) {
    body {
      padding: 10px;
    }

    .glass-card {
      padding: 20px !important;
      border-radius: 16px;
    }

    .icon-container {
      padding: 12px;
    }

    .icon-container i {
      font-size: 24px;
    }

    h1 {
      font-size: 1.5rem !important;
    }

    .glass-input {
      padding: 14px 14px 14px 44px;
      font-size: 14px;
    }

    .input-icon {
      left: 12px;
      font-size: 12px;
    }

    .btn-primary {
      padding: 14px 20px;
      font-size: 13px;
    }

    .subtitle-enter {
      font-size: 0.875rem;
    }
  }

  /* Tablet Responsive */
  @media (min-width: 481px) and (max-width: 768px) {
    body {
      padding: 15px;
    }

    .glass-card {
      padding: 30px !important;
      max-width: 450px !important;
    }

    .icon-container {
      padding: 14px;
    }

    .icon-container i {
      font-size: 28px;
    }

    h1 {
      font-size: 1.75rem !important;
    }
  }

  /* Desktop Responsive */
  @media (min-width: 769px) {
    .glass-card {
      max-width: 420px;
    }
  }
</style>
</head>
<body class="antialiased text-white">

<!-- Animated Particles -->
<div class="particles" id="particles"></div>

<!-- Simple Fade Transition Overlay -->
<div class="fade-transition" id="fadeTransition"></div>

<audio id="clickSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
<audio id="hoverSound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

<!-- Glass Card with transition wrapper -->
<div class="glass-card w-full max-w-md p-8 md:p-10" id="glassCard">
  <!-- Icon Section -->
  <div class="flex flex-col items-center mb-6">
    <div class="icon-container">
      <i class="fas fa-shield-alt"></i>
    </div>
    <h1 class="title-enter text-2xl md:text-3xl font-bold tracking-tight">Reset Password</h1>
    <p class="subtitle-enter mt-2 text-sm text-white/50">Enter your email to receive a reset link</p>
  </div>

  <!-- Recovery Form -->
  <form id="recoveryForm" class="space-y-5">
    <!-- Email Field -->
    <div class="form-section">
      <label for="recoveryEmail" class="block text-sm font-medium text-white/70 mb-2 ml-1">Email Address</label>
      <div class="glass-input-group">
        <input type="email" id="recoveryEmail" placeholder="Enter your email"
               class="glass-input"
               required autocomplete="email" />
        <i class="fas fa-envelope input-icon"></i>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="form-section">
      <button type="submit" 
              class="btn-primary w-full py-4 rounded-xl text-white font-semibold text-sm uppercase tracking-wider">
        Send Reset Link
      </button>
    </div>
  </form>

  <!-- Back to Login Link -->
  <div class="form-section mt-8 text-center">
    <a href="index.html" class="back-link">
      <i class="fas fa-arrow-left"></i>
      Back to Login
    </a>
  </div>
</div>

<script>
  // Generate floating particles
  function createParticles() {
    const container = document.getElementById('particles');
    const particleCount = 20;
    
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 15 + 's';
      particle.style.animationDuration = (15 + Math.random() * 10) + 's';
      container.appendChild(particle);
    }
  }

  createParticles();

  // Supabase setup
  const SUPABASE_URL = 'https://cwxpffwqpbedjffvpsbj.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_s2yXIg3L24wd0XYbrtnmPQ_HH_IN_e7';
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // Sound effects
  const clickSound = document.getElementById('clickSound');
  const hoverSound = document.getElementById('hoverSound');
  
  function playClick() {
    clickSound.currentTime = 0;
    clickSound.play().catch(() => {});
  }
  
  function playHover() {
    hoverSound.currentTime = 0;
    hoverSound.volume = 0.1;
    hoverSound.play().catch(() => {});
  }

  // Add hover sound to interactive elements
  document.querySelectorAll('a, button, input').forEach(el => {
    el.addEventListener('mouseenter', playHover);
  });

  // Input focus effects
  document.querySelectorAll('.glass-input').forEach(input => {
    input.addEventListener('focus', () => {
      playHover();
    });
  });

  // Fade transition for back link
  const fadeTransition = document.getElementById('fadeTransition');
  const glassCard = document.getElementById('glassCard');

  function navigateWithFade(url) {
    playClick();
    glassCard.classList.add('fade-out');
    setTimeout(() => {
      fadeTransition.classList.add('active');
      setTimeout(() => {
        window.location.href = url;
      }, 300);
    }, 250);
  }

  // Add transition to back link
  document.querySelector('.back-link').addEventListener('click', (e) => {
    e.preventDefault();
    navigateWithFade('index.html');
  });

  // Cooldown timer for send link (60 seconds)
  let sendLinkCooldown = false;
  const COOLDOWN_TIME = 60;

  // Form submission
  document.getElementById('recoveryForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    playClick();
    
    const email = document.getElementById('recoveryEmail').value.trim().toLowerCase();
    const submitBtn = e.target.querySelector('button[type="submit"]');
    
    // Check cooldown
    if (sendLinkCooldown) {
      const remainingTime = Math.ceil(parseInt(submitBtn.getAttribute('data-cooldown')));
      await Swal.fire({
        icon: 'warning',
        title: 'Please Wait',
        text: `You can resend the link in ${remainingTime} seconds`,
        background: 'rgba(15, 23, 42, 0.95)',
        color: '#fff',
        confirmButtonColor: '#6366f1'
      });
      return;
    }
    
    // Button loading state
    submitBtn.classList.add('loading');
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sending...';
    
    try {
      const { error } = await supabaseClient.auth.resetPasswordForEmail(email, {
        redirectTo: window.location.origin + '/update-password.html'
      });

      if (error) throw error;
      
      // Success state - start cooldown
      sendLinkCooldown = true;
      submitBtn.classList.remove('loading');
      submitBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
      
      let countdown = COOLDOWN_TIME;
      submitBtn.innerHTML = `<i class="fas fa-check mr-2"></i> Sent! (${countdown}s)`;
      submitBtn.setAttribute('data-cooldown', countdown);
      
      // Countdown timer
      const cooldownInterval = setInterval(() => {
        countdown--;
        if (countdown > 0) {
          submitBtn.innerHTML = `<i class="fas fa-clock mr-2"></i> Resend in ${countdown}s`;
          submitBtn.setAttribute('data-cooldown', countdown);
        } else {
          clearInterval(cooldownInterval);
          sendLinkCooldown = false;
          submitBtn.style.background = '';
          submitBtn.innerHTML = 'Send Reset Link';
          submitBtn.removeAttribute('data-cooldown');
        }
      }, 1000);
      
      await Swal.fire({
        icon: 'success',
        title: 'Reset Link Sent!',
        text: 'Check your email for the password reset link',
        background: 'rgba(15, 23, 42, 0.95)',
        color: '#fff',
        showConfirmButton: true,
        confirmButtonColor: '#6366f1'
      });

      // Redirect after a delay
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 3000);
      
    } catch (err) {
      // Error state
      submitBtn.classList.remove('loading');
      submitBtn.innerHTML = 'Send Reset Link';
      
      await Swal.fire({
        icon: 'error',
        title: 'Failed to Send',
        text: err.message,
        background: 'rgba(15, 23, 42, 0.95)',
        color: '#fff',
        confirmButtonColor: '#6366f1',
        confirmButtonText: 'Try Again'
      });
    }
  });
</script>
</body>
</html>
